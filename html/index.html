<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase_version9_RealtimeDB(G'sACADEMYåˆå­¦è€…ç”¨ã‚µãƒ³ãƒ—ãƒ«)</title>
 
    <link rel="stylesheet" href="/css/style.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/js/data.js"></script>





<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    
    //ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰â†“
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved }
        from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    
    
        
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBU8woI4pGqA6Oh0XXnlGv3Ci08THlZKAM",
    authDomain: "sample2-424f6.firebaseapp.com",
    databaseURL: "https://sample2-424f6-default-rtdb.firebaseio.com",
    projectId: "sample2-424f6",
    storageBucket: "sample2-424f6.appspot.com",
    messagingSenderId: "86021212650",
    appId: "1:86021212650:web:0461fcddcd5b3e51d28a93",
    measurementId: "G-WNFPMH5V3P"
    
    
    };
    
    
    
    
    // Initialize Firebase
    //â†“ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®åˆæœŸåŒ–
    const app = initializeApp(firebaseConfig);

    const db = getDatabase(app); // 
    //refã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ¼å‚ç…§ã‚³ãƒ¼ãƒ‰

    const dbRef = ref(db, "chat"); // RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†
    
    // ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Click)
    $('#send').on('click', function () {
        const uname = $('#uname').val();
        const text = $('#text').val();
        // å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ãŒç¢ºèªã§ããŸã‚ã¨ã¯

        // â†“firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ğŸ¤—ï¼ˆã¾ã firebaseã«é€ã£ã¦ã„ã¾ã›ã‚“ï¼ï¼‰
        //â†“ã¯ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ãŸã‚ã«ã€unameã¨textã‚’ã²ã¨ã¾ã¨ã‚ã«å®šç¾©ã—ãŸã€‚

        const msg = {
            uname: uname,
            text: text,
        }
    

        // firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹å‡¦ç†ã§ã™ğŸ¤—
        // pushã¯firebaseãŒç”¨æ„ã—ãŸãŠã¾ã˜ãªã„ã§ã™ï¼ï¼ˆæ³¨æ„ï¼ï¼‰
        //newPostRefã‚‚ãƒ•ã‚£ã‚¢ãƒ¼ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ç”¨ã®ã‚³ãƒ¼ãƒ‰ 
        const newPostRef = push(dbRef);
        // setã¯firebaseãŒç”¨æ„ã—ãŸãŠã¾ã˜ãªã„ã€ä¿å­˜ã™ã‚‹ã¨ã„ã†ã“ã¨ã€‚
        //ã¤ã¾ã‚Šâ†“ã§msgã®ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜ãŒå®Œäº†ã—ãŸã¨ã„ã†ã“ã¨ã€‚
        set(newPostRef, msg);
    
        // é€ä¿¡ã‚’æŠ¼ã—ãŸã‚‰å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ã‚’æ¶ˆã™ã«ã¯ï¼Ÿï¼Ÿ
        $('#uname').val("")
        $('#text').val("");
    
        // ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
    })
    
    // ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Enter)â†’å¤šåˆ†ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã¨ã£ã¦ãã‚‹ã¨ã„ã†æ„å‘³ã§ã®ã€ãƒ‡ãƒ¼ã‚¿å–å¾—
    // æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapshotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        //onchildaddedã¯ã€ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å‚ç…§ã™ã‚‹çš„ãªãƒ¡ã‚½ãƒƒãƒ‰
    onChildAdded(dbRef, function (data) {
      
        const msg = data.val();   
        const key = data.key;

        let html, htmlf, htmlt;
        

// ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒ†ã‚­ã‚¹ãƒˆãŒã€Œé›°å›²æ°—ã€ã‚’å«ã‚€å ´åˆ
if (msg.uname.includes("é›°å›²æ°—")) {
    htmlf = `
        <div class=${key}>
            <p>${msg.uname}</p>
            <p>${msg.text}</p>
        </div>
    `;
}
// ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒ†ã‚­ã‚¹ãƒˆãŒã€Œå¾…é‡ã€ã‚’å«ã‚€å ´åˆ
else if (msg.uname.includes("å¾…é‡")) {
    htmlt = `
        <div class=${key}>
            <p>${msg.uname}</p>
            <p>${msg.text}</p>
        </div>
    `;
}
// ä¸Šè¨˜ã®æ¡ä»¶ã«å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆ
else {
    html = `
        <div class=${key}>
            <p>${msg.uname}</p>
            <p>${msg.text}</p>
        </div>
    `;
}


        
    
        // ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã«åŸ‹ã‚è¾¼ã¿ã¾ã™
        $('#output').append(html)

        $('#count1').append(htmlf)

        $('#count2').append(htmlt)
    
    })
    
    
    </script>
    
</head>






<body>
    <h1>ã¯ã˜ã‚ã¾ã—ã¦ãƒãƒ£ãƒƒãƒˆ</h1>
    <p class = tittle>ã€ŒãŠã ã„ã€ã¨å…¥åŠ›ã™ã‚Œã°ã€ä¼šè©±ã®ãŠé¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
    <p class = tittle>ã€ŒãŠé¡Œã€ã¸ã®ãƒãƒ£ãƒƒãƒˆã§ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ã‚‡ã†ï¼</p>

    <br>
    <br>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div>
        <!-- å„å ´æ‰€ã«idã‚’è¨­å®šã—ã¾ã—ã‚‡ã† -->
        <div>
            <input id="uname" type="text" placeholder="è³ªå•ã‚¸ãƒ£ãƒ³ãƒ«">
        </div>
        <div>
            <textarea id="text" placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        </div>
      <div class = W>
         <button id="send">é€ä¿¡ï¼ï¼</button>
         <button id="clear">å‰Šé™¤</button>
      </div>  
        <!-- style.cssã« "overflow: auto;"ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼â€»æœ€å¾Œã« -->
        <div id="output"></div>
    </div>

    <br>
    <br>

<br>
<br>

<div class = count>
    <div id = count1> é›°å›²æ°—ç³»</div>
    <div id = count2> å¾…é‡ç³»</div>
    <div id = count3> ã‚„ã‚ŠãŒã„ç³»</div>
    <div id = count4> ä»•äº‹å†…å®¹ã«ã¤ã„ã¦</div>
</div>


<br>
<br>
<br>
<br>
<br>

</body>

</html>